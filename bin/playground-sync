#!/usr/bin/ruby

require 'fileutils'
require 'date'

puts "Starting Playground sync ..."
playground_project = File.join(ENV["HOME"], "dev", "code", "playground-files")
playground_globs = File.join(ENV["HOME"], "**", "play.clj")
playground_files = Dir.glob(playground_globs)

puts "There are #{playground_files.count} file(s) to be synced."

playground_files.each do |file|
  file_segments = file.split('/')
  project_name = file_segments[5]

  backup_destination = File.join(*playground_project, project_name + ".clj")

  puts "=> Saving #{file} in #{backup_destination} ..."
  FileUtils.copy_file(file, backup_destination)
end

puts "Doing git stuff ..."
FileUtils.cd(playground_project)
system("git add .")
commit_message = "#{Time.now} -- Adding new files"
unless `git status`.include?("nothing to commit")
  system("git commit -m '#{commit_message}'")
  system("git push origin master")
else
  puts "<!> Nothing to commit"
end

puts "Playground sync complete!"
